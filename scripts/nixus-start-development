#!/usr/bin/env bash

PROJECTS=$(find ~/workspace/* -maxdepth 0 -type d | grep -v "mish" | grep -v "flake")

if [ -z "$PROJECTS" ]; then
    notify-send "No Projects" "No projects found in ~/workspace"
    exit 1
fi

# Show only the basename of directories in rofi for cleaner display
PROJECT_NAMES=$(echo "$PROJECTS" | xargs -n1 basename)

# Use rofi to select a project
SELECTED_NAME=$(echo "$PROJECT_NAMES" | rofi -dmenu -p "Select Project" -theme-str 'window {width: 40%;} listview {lines: 10;}')

# Exit if nothing selected
if [ -z "$SELECTED_NAME" ]; then
    exit 0
fi

# Get the full path of the selected project
SELECTED_PATH=$(echo "$PROJECTS" | grep "/$SELECTED_NAME$")

# Open Ghostty terminal and run nix develop
ghostty --working-directory="$SELECTED_PATH" --command="bash -c 'cd \"$SELECTED_PATH\" && nix develop -c \$SHELL'"
